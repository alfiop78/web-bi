



--\* Creazione tabella per il calcolo delle metriche:[netto_format_ly] */
CREATE TABLE decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/> AS SELECT
   Azienda34.CodDealerCM as AZ_CODFORD_ID,Azienda34.CodDealerCM as AZ_CODFORD_DS,
   DocVenditaDettaglio.id_Azienda as DESCRIZIONE_AZIENDA_ID,Azienda640.descrizione as DESCRIZIONE_AZIENDA_DS,
   LK_YEAR577.ID_YEAR as YEAR_ID,LK_YEAR577.DSS_YEAR as YEAR_DS,
    NVL(SUM(DocVenditaDettaglio.NettoRiga),0)  AS NETTO_FORMAT_LY_
FROM
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.Azienda Azienda34,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.Azienda Azienda640,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.DocVenditaDettaglio DocVenditaDettaglio,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.LK_DATE LK_DATE,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.LK_MONTH LK_MONTH575,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.LK_QUARTER LK_QUARTER576,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.LK_YEAR LK_YEAR577
 WHERE
   (   Azienda640.id = 473  )
   AND   (   LK_YEAR577.ID_YEAR  = 2024  )
   AND   DocVenditaDettaglio.DataDocumento=LK_DATE.ID_DAY
   AND   DocVenditaDettaglio.id_Azienda=Azienda34.id
   AND   DocVenditaDettaglio.id_Azienda=Azienda640.id
   AND   LK_MONTH575.ID_MONTH=LK_DATE.ID_MONTH
   AND   LK_QUARTER576.ID_QUARTER=LK_MONTH575.ID_QUARTER
   AND   LK_QUARTER576.ID_YEAR=LK_YEAR577.TRANS_LY
GROUP BY
   Azienda34.CodDealerCM,
   DocVenditaDettaglio.id_Azienda,
   Azienda640.descrizione,
   LK_YEAR577.ID_YEAR,
   LK_YEAR577.DSS_YEAR
;




--\* Creazione tabella per il calcolo delle metriche:[Venduto] */
CREATE TABLE decisyon_cache.DX1711530753035486119@<AUTOMOTIVE_BI_DATA/> AS SELECT
   Azienda34.CodDealerCM as AZ_CODFORD_ID,Azienda34.CodDealerCM as AZ_CODFORD_DS,
   DocVenditaDettaglio.id_Azienda as DESCRIZIONE_AZIENDA_ID,Azienda640.descrizione as DESCRIZIONE_AZIENDA_DS,
   LK_QUARTER576.ID_YEAR as YEAR_ID,LK_YEAR577.DSS_YEAR as YEAR_DS,
   SUM(DocVenditaDettaglio.NettoRiga) AS NETTORIGA_SUM_
FROM
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.Azienda Azienda34,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.Azienda Azienda640,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.DocVenditaDettaglio DocVenditaDettaglio,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.LK_DATE LK_DATE,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.LK_MONTH LK_MONTH575,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.LK_QUARTER LK_QUARTER576,
   automotive_bi_data@<AUTOMOTIVE_BI_DATA/>.LK_YEAR LK_YEAR577
 WHERE
   (   DocVenditaDettaglio.id_Azienda = 473  )
   AND   (   LK_QUARTER576.ID_YEAR  = 2024  )
   AND   DocVenditaDettaglio.DataDocumento=LK_DATE.ID_DAY
   AND   DocVenditaDettaglio.id_Azienda=Azienda34.id
   AND   DocVenditaDettaglio.id_Azienda=Azienda640.id
   AND   LK_MONTH575.ID_MONTH=LK_DATE.ID_MONTH
   AND   LK_QUARTER576.ID_QUARTER=LK_MONTH575.ID_QUARTER
   AND   LK_YEAR577.ID_YEAR=LK_QUARTER576.ID_YEAR
GROUP BY
   Azienda34.CodDealerCM,
   DocVenditaDettaglio.id_Azienda,
   Azienda640.descrizione,
   LK_QUARTER576.ID_YEAR,
   LK_YEAR577.DSS_YEAR
;




--\* Creazione tabella temporanea contenente i valori dimensionali */
CREATE TABLE decisyon_cache.UX1711530753035744121@<AUTOMOTIVE_BI_DATA/> AS SELECT
 decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.AZ_CODFORD_ID AS AZ_CODFORD_ID,decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.AZ_CODFORD_DS AS AZ_CODFORD_DS,
 decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.DESCRIZIONE_AZIENDA_ID AS DESCRIZIONE_AZIENDA_ID,decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.DESCRIZIONE_AZIENDA_DS AS DESCRIZIONE_AZIENDA_DS,
 decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.YEAR_ID AS YEAR_ID,decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.YEAR_DS AS YEAR_DS
FROM decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>;




--\* Inserimento in tabella temporanea */
INSERT INTO decisyon_cache.UX1711530753035744121@<AUTOMOTIVE_BI_DATA/>
(AZ_CODFORD_ID,AZ_CODFORD_DS,DESCRIZIONE_AZIENDA_ID,DESCRIZIONE_AZIENDA_DS,YEAR_ID,YEAR_DS)
 SELECT
AZ_CODFORD_ID,AZ_CODFORD_DS,DESCRIZIONE_AZIENDA_ID,DESCRIZIONE_AZIENDA_DS,YEAR_ID,YEAR_DS  FROM decisyon_cache.DX1711530753035486119@<AUTOMOTIVE_BI_DATA/>;




--\* Creazione tabella temporanea finale contenente valori distinti */
CREATE TABLE decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/> AS SELECT DISTINCT
AZ_CODFORD_ID,AZ_CODFORD_DS,
DESCRIZIONE_AZIENDA_ID,DESCRIZIONE_AZIENDA_DS,
YEAR_ID,YEAR_DS FROM decisyon_cache.UX1711530753035744121@<AUTOMOTIVE_BI_DATA/>;




--\* Creazione del datamart finale */
CREATE TABLE decisyon_cache.FX1711530753035142122@<AUTOMOTIVE_BI_DATA/> AS SELECT
   decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.AZ_CODFORD_ID,decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.AZ_CODFORD_DS,
   decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.DESCRIZIONE_AZIENDA_ID,decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.DESCRIZIONE_AZIENDA_DS,
   decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.YEAR_ID,decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.YEAR_DS,
   NETTORIGA_SUM_ AS NETTORIGA_SUM_,
    NVL(NETTO_FORMAT_LY_,0)  AS NETTO_FORMAT_LY_
FROM
   decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>
  left outer join decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>  on (
     decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.AZ_CODFORD_ID=decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.AZ_CODFORD_ID AND
     decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.DESCRIZIONE_AZIENDA_ID=decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.DESCRIZIONE_AZIENDA_ID AND
     decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.YEAR_ID=decisyon_cache.DX1711530753035381118@<AUTOMOTIVE_BI_DATA/>.YEAR_ID)
  left outer join decisyon_cache.DX1711530753035486119@<AUTOMOTIVE_BI_DATA/>  on (
     decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.AZ_CODFORD_ID=decisyon_cache.DX1711530753035486119@<AUTOMOTIVE_BI_DATA/>.AZ_CODFORD_ID AND
     decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.DESCRIZIONE_AZIENDA_ID=decisyon_cache.DX1711530753035486119@<AUTOMOTIVE_BI_DATA/>.DESCRIZIONE_AZIENDA_ID AND
     decisyon_cache.UX1711530753035474120@<AUTOMOTIVE_BI_DATA/>.YEAR_ID=decisyon_cache.DX1711530753035486119@<AUTOMOTIVE_BI_DATA/>.YEAR_ID)
;




--\* Ricerca CubeView:[Venduto] */
;




--\* Ricerca CubeView:[netto_format_ly] */
;

